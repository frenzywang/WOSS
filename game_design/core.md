# ğŸ”¥ ä½¿ç”¨ Flutter Flame å®ç°æ ¸å¿ƒç©æ³•çš„å®Œæ•´è®¾è®¡æ–‡æ¡£ï¼ˆLLM å¯ç†è§£æ ¼å¼ï¼‰

---

## âœ… é¡¹ç›®æ¦‚å†µ

- **é¡¹ç›®ç±»å‹**ï¼šå¼¹ç å¼å›åˆåˆ¶æˆ˜æ–—æ¸¸æˆ
- **å¼€å‘è¯­è¨€**ï¼šDartï¼ˆåŸºäº Flutter + Flame æ¸¸æˆå¼•æ“ï¼‰
- **ç›®æ ‡å¹³å°**ï¼šiOS / Android / Webï¼ˆä¼˜å…ˆæ”¯æŒç§»åŠ¨ç«¯ï¼‰
- **å¼•æ“æ¡†æ¶**ï¼šFlame + Forge2Dï¼ˆç”¨äºç‰©ç†å¼¹å°„ï¼‰

---

## ğŸ® æ¸¸æˆæ ¸å¿ƒç©æ³•æ¦‚è¿°

ç©å®¶æ§åˆ¶ä¸€ä¸ªç”±å¤šä¸ªå¼¹ç å•ä½ï¼ˆè§’è‰²ï¼‰ç»„æˆçš„å°é˜Ÿï¼Œé€šè¿‡æ‹–åŠ¨è§’è‰²ï¼ˆå¼¹ç ï¼‰è¿›è¡Œå¼¹å°„æ”»å‡»ã€‚æ¯ä¸ªè§’è‰²æ‹¥æœ‰ä¸€ä¸ªèŒä¸šä¸ä¸“å±æŠ€èƒ½ã€‚æˆ˜æ–—ä¸º **å›åˆåˆ¶**ï¼ŒåŒæ–¹è½®æµæ“ä½œï¼Œåœ°å›¾å°è€Œç´§å‡‘ï¼Œå¼ºè°ƒç­–ç•¥å¼¹å°„ä¸æŠ€èƒ½ç»„åˆã€‚

---

## ğŸ§± æŠ€æœ¯ç»“æ„æ€»è§ˆï¼ˆFlame é€‚é…ï¼‰

| æ¨¡å— | æŠ€æœ¯å®ç°å»ºè®® |
|------|----------------|
| æ¸¸æˆä¸»å¾ªç¯ | `FlameGame` æˆ– `Forge2DGame` |
| ç‰©ç†å¼¹å°„ | `Forge2D`ï¼ˆFlame ç‰©ç†ç³»ç»Ÿï¼‰ |
| åœ°å›¾ä¸éšœç¢ç‰© | è‡ªå®šä¹‰ç»„ä»¶ + `BodyComponent`ï¼ˆç‰©ç†å¢™ä½“ï¼‰ |
| è§’è‰²å¼¹ç  | `BodyComponent` + æ‹–æ‹½æ§åˆ¶é€»è¾‘ |
| æŠ€èƒ½ç³»ç»Ÿ | äº‹ä»¶è§¦å‘ç³»ç»Ÿ + æ•°æ®é…ç½® |
| å›åˆç®¡ç† | è‡ªå®šä¹‰ GameController æ§åˆ¶çŠ¶æ€æœº |
| UIå±‚ | Flutter Widget Overlayï¼ˆè¡€æ¡ã€æŠ€èƒ½æŒ‰é’®ç­‰ï¼‰ |

---

## ğŸš€ æ ¸å¿ƒç©æ³•å¾ªç¯ï¼ˆGame Loopï¼‰

```plaintext
[ç»„é˜Ÿ] â†’ [è¿›å…¥åœ°å›¾] â†’ [å›åˆå¼€å§‹] â†’ [ç©å®¶æ‹–åŠ¨å¼¹å°„è§’è‰²] â†’ [ç¢°æ’æ£€æµ‹ + æŠ€èƒ½è§¦å‘] â†’ [è§’è‰²åœä¸‹] â†’ [åˆ‡æ¢å›åˆ] â†’ ...
```

### å›åˆåˆ¶ç»†èŠ‚
- æ¯ä¸ªé˜Ÿä¼è½®æµæ“ä½œï¼Œæ¯ä¸ªè§’è‰²æ¯å›åˆåªèƒ½å¼¹å°„ä¸€æ¬¡
- æŠ€èƒ½æœ‰å†·å´æˆ–èƒ½é‡æœºåˆ¶ï¼ˆå¯é€‰ï¼‰
- æˆ˜æ–—æŒç»­ï¼Œç›´åˆ°ä¸€æ–¹å…¨ç­æˆ–æ»¡è¶³èƒœåˆ©æ¡ä»¶

---

## ğŸ§© è§’è‰²ç³»ç»Ÿï¼ˆå¼¹ç å•ä½ï¼‰

### èŒä¸šåˆ†ç±»ï¼ˆäº”ç§ï¼‰
| èŒä¸š | æè¿° | å¼¹æ€§ | è´¨é‡ï¼ˆè´¨é‡å½±å“åŠ›çŸ©/åå¼¹ï¼‰ |
|------|------|------|----------------|
| è‚‰ç›¾ | é«˜è¡€/æŠ—å‡»é€€ | ä½ï¼ˆ0.1ï¼‰ | é«˜ï¼ˆ10ï¼‰ |
| æ³•å¸ˆ | é«˜ä¼¤ä½é˜² | é«˜ï¼ˆ0.9ï¼‰ | ä½ï¼ˆ3ï¼‰ |
| å°„æ‰‹ | ç²¾å‡†ä¼¤å®³ | ä¸­ï¼ˆ0.6ï¼‰ | ä¸­ï¼ˆ5ï¼‰ |
| æˆ˜å£« | ä¸‡èƒ½è¿‘æˆ˜ | ä¸­ | ä¸­ |
| è¾…åŠ© | æ²»ç–—/å¢ç›Š | ä¸­ | ä¸­ |

### å±æ€§å­—æ®µï¼ˆDartç±»ç»“æ„ç¤ºä¾‹ï¼‰ï¼š
```dart
class BattleUnit {
  final String id;
  final String name;
  final UnitClass unitClass;
  int hp;
  int atk;
  double mass;
  double elasticity;
  Skill activeSkill;
  Skill? passiveSkill;
}
```

---

## ğŸ¯ å¼¹å°„æ§åˆ¶ç³»ç»Ÿï¼ˆFlame + Forge2D å®ç°ï¼‰

### æ‹–åŠ¨ & å¼¹å°„
- ä½¿ç”¨ Flame çš„ `GestureDetectorComponent` æˆ–æ‰‹åŠ¨ç›‘å¬ `onPanStart / onPanUpdate / onPanEnd`
- æ‹–åŠ¨ç®­å¤´ï¼ˆUIï¼‰å±•ç¤ºæ–¹å‘ä¸åŠ›åº¦
- æ¾æ‰‹åå°†è§’è‰²æ–½åŠ åŠ›ï¼ˆapplyLinearImpulseï¼‰

### ç¤ºä¾‹ä¼ªä»£ç 
```dart
void onPanEnd(DragEndDetails details) {
  final direction = dragStart - dragEnd;
  final force = direction.normalized() * forceMultiplier;
  body.applyLinearImpulse(force);
}
```

---

## ğŸ’¥ ç¢°æ’ä¸æŠ€èƒ½è§¦å‘ï¼ˆForge2Dï¼‰

### ç¢°æ’å¤„ç†
- ä½¿ç”¨ `ContactCallback` æ³¨å†Œè§’è‰²ä¸å…¶ä»–å•ä½/åœ°å›¾çš„ç¢°æ’
- åˆ¤æ–­ç¢°æ’å¯¹è±¡ï¼Œè§¦å‘æŠ€èƒ½æˆ–ä¼¤å®³é€»è¾‘

### æŠ€èƒ½è§¦å‘æœºåˆ¶
```dart
class Skill {
  final String id;
  final String name;
  final SkillTrigger trigger;
  final SkillEffect effect;
  final int cooldown;
}
```

- è§¦å‘ç±»å‹ï¼šonCollisionã€onCastã€onKillã€onTurnStart
- æ•ˆæœç±»å‹ï¼šdamage, heal, stun, burn, buff, shield

---

## ğŸ—ºï¸ åœ°å›¾ç³»ç»Ÿï¼ˆå°åœ°å›¾ + åœ°å½¢æœºåˆ¶ï¼‰

### ç‰¹æ€§
- åœ°å›¾å›ºå®šå°ºå¯¸ï¼ˆå¦‚ 1024x768ï¼‰ï¼Œå°½é‡ä¸æ»šåŠ¨
- ä½¿ç”¨ `WallComponent` åˆ›å»ºè¾¹ç•Œ
- å¯åŠ å…¥åœ°å½¢æœºå…³ï¼ˆå¦‚é™·é˜±ã€åŠ é€Ÿå¸¦ã€ä¼ é€å£ï¼‰

### åœ°å›¾ç»“æ„ï¼ˆJSON ç¤ºä¾‹ï¼‰ï¼š
```json
{
  "id": "map_001",
  "walls": [[0,0,1024,10], [0,768,1024,10]],
  "traps": [{"x": 300, "y": 300, "radius": 50}]
}
```

---

## ğŸ” å›åˆç®¡ç†ç³»ç»Ÿ

### çŠ¶æ€ç®¡ç†ï¼ˆGameStateï¼‰

```dart
enum GameState {
  waitingForInput,
  animating,
  enemyTurn,
  gameOver,
}
```

- æ§åˆ¶å½“å‰è½®åˆ°è°å‡ºæ‰‹
- æ§åˆ¶æ˜¯å¦å…è®¸æ‹–åŠ¨
- æ§åˆ¶æŠ€èƒ½é‡Šæ”¾ä¸å†·å´

---

## ğŸ§  AI æ§åˆ¶ç³»ç»Ÿï¼ˆç®€åŒ–ï¼‰

- æ•Œæ–¹å•ä½ä½¿ç”¨ç®€å•ç­–ç•¥ï¼š
  - éšæœºç›®æ ‡ â†’ è®¡ç®—å‘é‡ â†’ å¼¹å°„
  - æˆ–ä½¿ç”¨è„šæœ¬åŒ–è¡ŒåŠ¨ï¼ˆæŠ€èƒ½ä¼˜å…ˆé‡Šæ”¾ï¼‰

---

## ğŸ–¼ï¸ UI ä¸è¡¨ç°å±‚

### æŠ€æœ¯é€‰å‹
- ä½¿ç”¨ Flame çš„ `Overlay` ç³»ç»Ÿï¼Œå°† Flutter Widgets å åŠ åœ¨æ¸¸æˆä¹‹ä¸Š
- åŒ…æ‹¬ï¼š
  - è¡€æ¡ã€æŠ€èƒ½æŒ‰é’®ã€å†·å´æ—¶é—´
  - æ‹–åŠ¨ç®­å¤´æ˜¾ç¤º
  - å›åˆæç¤ºä¸èƒœè´Ÿåˆ¤å®š

---

## ğŸ§ª ç¤ºä¾‹å¼€å‘ä»»åŠ¡æ‹†åˆ†ï¼ˆLLM å¯ç†è§£ï¼‰

### 1. åˆ›å»ºåœ°å›¾ä¸è¾¹ç•Œå¢™ä½“ç»„ä»¶
```dart
class WallComponent extends BodyComponent { ... }
```

### 2. åˆ›å»ºå¼¹ç è§’è‰²ç»„ä»¶
```dart
class UnitComponent extends BodyComponent {
  BattleUnit unitData;
  void onCollision(...) => triggerSkill();
}
```

### 3. å®ç°æ‹–åŠ¨å¼¹å°„é€»è¾‘
```dart
class DragController extends Component {
  void onPanStart(...) => recordStart();
  void onPanEnd(...) => applyImpulseToUnit();
}
```

### 4. æŠ€èƒ½ç³»ç»Ÿå®ç°
```dart
class SkillManager {
  void trigger(Skill skill, UnitComponent caster, UnitComponent target);
}
```

### 5. å›åˆæ§åˆ¶å™¨
```dart
class TurnManager {
  GameState state;
  void nextTurn();
}
```

---

## ğŸ“¦ æ•°æ®ç»“æ„ä¸é…ç½®å»ºè®®

### æŠ€èƒ½ JSON ç¤ºä¾‹
```json
{
  "id": "fire_blast",
  "name": "ç«ç„°çˆ†è£‚",
  "trigger": "onCast",
  "effect": {
    "type": "circle_aoe",
    "radius": 100,
    "damage": 200,
    "burn": true
  },
  "cooldown": 3
}
```

### åœ°å›¾ JSON ç¤ºä¾‹
```json
{
  "id": "map_001",
  "walls": [...],
  "traps": [...],
  "spawnPoints": {
    "player": [[100,200], [150,200]],
    "enemy": [[800,600], [850,600]]
  }
}
```

---

## âœ… LLM Prompt ç¤ºä¾‹ï¼ˆå¯ç”¨äºå¼€å‘ï¼‰

```plaintext
ä½ æ˜¯ä¸€ä¸ª Flutter Flame æ¸¸æˆå¼€å‘åŠ©æ‰‹ã€‚æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªå¼¹ç å›åˆåˆ¶æˆ˜æ–—æ¸¸æˆï¼Œè¯·å¸®æˆ‘ç”¨ Flame + Forge2D å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

1. åˆ›å»ºä¸€ä¸ªå¯ä»¥æ‹–åŠ¨å¹¶å¼¹å°„çš„è§’è‰²ç»„ä»¶ï¼ˆä½¿ç”¨ BodyComponentï¼‰
2. è§’è‰²åœ¨ç¢°æ’æ—¶è§¦å‘ä¸€ä¸ªæŠ€èƒ½å‡½æ•°
3. ç®¡ç†å›åˆçŠ¶æ€ï¼Œè½®æµæ§åˆ¶ç©å®¶ä¸AIè§’è‰²
4. ä½¿ç”¨ JSON åŠ è½½æŠ€èƒ½ä¸åœ°å›¾æ•°æ®
```

---

## âœ… æ€»ç»“ï¼šä½¿ç”¨ Flame å¼€å‘çš„ä¼˜åŠ¿

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| è·¨å¹³å° | ä¸€å¥—ä»£ç æ”¯æŒ Android / iOS / Web |
| è½»é‡å°è£… | é€‚åˆå¿«é€ŸåŸå‹å¼€å‘ä¸ 2D æ¸¸æˆ |
| Forge2D | å¼ºå¤§çš„ç‰©ç†å¼•æ“ï¼Œé€‚åˆå¼¹å°„ç©æ³• |
| Flutter UI | å¯ä½¿ç”¨ Flutter å®Œæ•´ UI åŠŸèƒ½æ„å»ºç•Œé¢ |

---

## ğŸ“Œ åç»­å¯æ‹“å±•æ–¹å‘

- è§’è‰²å…»æˆç³»ç»Ÿï¼ˆå‡çº§/å¼ºåŒ–/æŠ€èƒ½è§£é”ï¼‰
- å¤šåœ°å›¾ + ç« èŠ‚å¼æˆ˜å½¹
- PVP æ’ä½ï¼ˆå›åˆåˆ¶å¼‚æ­¥åŒ¹é…ï¼‰
- åœ°å›¾ç¼–è¾‘å™¨ï¼ˆFlutter App å®ç°ï¼‰
